<div class="row">
    <div class="col-md-12">
        <h1 class="admin-heading"><i class="fa fa-comments"></i> Comments Management</h1>
    </div>
    <div class="col-md-12">
        <div id="mytable"></div>
    </div>
</div>

<script src="https://unpkg.com/tabulator-tables@5.5.2/dist/js/tabulator.min.js"></script>
<script>
    const comments = <%- JSON.stringify(comments) %>;
    document.addEventListener("DOMContentLoaded", () => {
        new Tabulator("#mytable", {
            data: comments,
            layout: "fitColumns",
            pagination:true,
            paginationSize:10,
            paginationSizeSelector:[2,5,10,15],
            downloadRowRange: "visible",
            placeholder:"No Data Set",
            columns:[
                {title:"S.No.", formatter:"rownum", width:50, hozAlign:"center"},
                {title:"News", field:"news.content", headerFilter:"input",
                    formatter: function (cell) {
                        const value = cell.getValue();
                        return value
                        ? value
                        : "";
                    }
                },
                {title:"Name", field:"name", headerFilter:"input"},
                {title:"Comment", field:"content", headerFilter:"input"},
                {title:"Status", field:"status", headerFilter:"input"},
                {title: "Date", field: "createdAt",
                    headerFilter: "input",
                    formatter: function (cell) {
                        const value = cell.getValue();
                        return value
                        ? new Date(value).toLocaleString()
                        : "";
                    }
                },
                {title:"Action", formatter:function(cell, formatterParams, onRendered){
                    return `<a href="javascript:void(0)" onclick="onView('${cell.getData()._id}')" class="btn btn-info btn-sm"><i class="fa fa-edit">View</i></a>
                            <a href="javascript:void(0)" onclick="onDelete('${cell.getData()._id}')" class="btn btn-outline-danger btn-sm"><i class="fa fa-trash-o"></i>Delete</a>`;
                }},
                
            ],
        });
    });

    async function onDelete(id){
        if(confirm('Are you sure?')){
            const response = await fetch(`/admin/news/delete/${id}`, {
                method: 'DELETE'
            })
            if(response.ok){
                window.location.reload();
            }
        }
    }

    
</script>

<%- contentFor('tabulatorCss') %>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
<link href="https://unpkg.com/tabulator-tables@6.3.1/dist/css/tabulator.min.css" rel="stylesheet">